{% extends 'base.html' %}
{% block content %}
<div class="container py-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="text-primary fw-bold">👤 Your Profile</h2>
    <a href="{{ url_for('main.dashboard') }}" class="btn btn-outline-secondary">🔙 Back to Dashboard</a>
  </div>

  <form method="POST" action="{{ url_for('main.profile') }}" class="row g-4" id="profile-form">
    <!-- Full Name -->
    <div class="col-md-6">
      <label for="name" class="form-label fw-semibold">Full Name <span class="text-danger">*</span></label>
      <div class="input-group shadow-sm">
        <span class="input-group-text bg-light">👤</span>
        <input type="text" class="form-control" name="name" id="name" value="{{ user_data.name or '' }}" required readonly>
        <button class="btn btn-outline-primary" type="button" onclick="enableEdit('name')">✏️</button>
      </div>
    </div>

    <!-- Mobile Number -->
    <div class="col-md-6">
      <label for="mobile" class="form-label fw-semibold">Mobile Number <span class="text-danger">*</span></label>
      <div class="input-group shadow-sm">
        <span class="input-group-text bg-light">📱</span>
        <input type="text" class="form-control" name="mobile" id="mobile" value="{{ user_data.mobile or '' }}" required readonly>
        <button class="btn btn-outline-primary" type="button" onclick="enableEdit('mobile')">✏️</button>
      </div>
    </div>

    <!-- WhatsApp Number -->
    <div class="col-md-6">
      <label for="whatsapp" class="form-label fw-semibold">WhatsApp Number</label>
      <div class="input-group shadow-sm">
        <span class="input-group-text bg-light">💬</span>
        <input type="text" class="form-control" name="whatsapp" id="whatsapp" value="{{ user_data.whatsapp or '' }}" readonly>
        <button class="btn btn-outline-primary" type="button" onclick="enableEdit('whatsapp')">✏️</button>
      </div>
    </div>

    <!-- Education -->
    <div class="col-md-6">
      <label for="education" class="form-label fw-semibold">Education <span class="text-danger">*</span></label>
      <div class="input-group shadow-sm">
        <span class="input-group-text bg-light">🎓</span>
        <input type="text" class="form-control" name="education" id="education" value="{{ user_data.education or '' }}" required readonly>
        <button class="btn btn-outline-primary" type="button" onclick="enableEdit('education')">✏️</button>
      </div>
    </div>

    <!-- Permanent Address -->
    <div class="col-12">
      <label for="permanent_address" class="form-label fw-semibold">Permanent Address <span class="text-danger">*</span></label>
      <div class="input-group shadow-sm">
        <span class="input-group-text bg-light">🏠</span>
        <textarea class="form-control" name="permanent_address" id="permanent_address" rows="2" required readonly>{{ user_data.permanent_address or '' }}</textarea>
        <button class="btn btn-outline-primary" type="button" onclick="enableEdit('permanent_address')">✏️</button>
      </div>
    </div>

    <!-- Current Address -->
    <div class="col-12">
      <label for="current_address" class="form-label fw-semibold">Current Address</label>
      <div class="input-group shadow-sm">
        <span class="input-group-text bg-light">📍</span>
        <textarea class="form-control" name="current_address" id="current_address" rows="2" readonly>{{ user_data.current_address or '' }}</textarea>
        <button class="btn btn-outline-primary" type="button" onclick="enableEdit('current_address')">✏️</button>
      </div>
    </div>

    <!-- Form Buttons -->
    <div class="col-12 d-flex justify-content-between mt-4">
      <a href="{{ url_for('main.dashboard') }}" class="btn btn-outline-secondary">🔙 Back</a>
      <button type="submit" class="btn btn-success px-4">✅ Save Changes</button>
    </div>
  </form>
</div>

<!-- JS to Enable Editing -->
<script>
  function enableEdit(fieldId) {
    const field = document.getElementById(fieldId);
    field.removeAttribute('readonly');
    field.classList.add('border-primary', 'shadow-sm');
    field.focus();
  }

  document.getElementById('profile-form').addEventListener('submit', function (e) {
    let changed = false;
    document.querySelectorAll('input, textarea').forEach(input => {
      if (!input.readOnly) {
        changed = true;
      }
    });

    if (!changed) {
      e.preventDefault();
      alert("⚠️ Please edit at least one field before saving.");
    }
  });
</script>
{% endblock %}

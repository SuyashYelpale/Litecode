{% extends 'base.html' %}
{% block content %}
<h2 class="mb-4 text-primary">
  {% if all_batches_view %}
    üì¶ All Batches
  {% else %}
    üì¶ Batches for "{{ class_data.name }}"
  {% endif %}
</h2>

<!-- Navigation/Filter -->
<div class="d-flex justify-content-between mb-3">
  {% if all_batches_view %}
    <div class="col-md-3">
      <select class="form-select" onchange="if(this.value) window.location.href=this.value">
        <option value="">Filter by Class</option>
        <option value="{{ url_for('main.batches') }}" 
                {% if not request.args.get('class_id') %}selected{% endif %}>
          All Classes
        </option>
        {% for cls in classes %}
        <option value="{{ url_for('main.batches', class_id=cls.id) }}"
                {% if request.args.get('class_id')|int == cls.id %}selected{% endif %}>
          {{ cls.name }}
        </option>
        {% endfor %}
      </select>
    </div>
  {% else %}
    <div>
      <a href="{{ url_for('main.classes') }}" class="btn btn-outline-secondary">
        ‚Üê Back to Classes
      </a>
    </div>
  {% endif %}
</div>

<!-- Add Batch Form -->
{% if not all_batches_view %}
<div class="card shadow-sm mb-4">
  <div class="card-body">
    <form method="POST" class="row g-3">
      <input type="hidden" name="class_id" value="{{ class_data.id }}">
      
      <div class="col-md-4">
        <input name="batch_name" class="form-control" placeholder="Batch Name" required>
      </div>
      
      <div class="col-md-2">
        <select name="day" class="form-select" required>
          <option value="" selected disabled>Day</option>
          {% for day in ['Monday','Tuesday','Wednesday','Thursday','Friday','Saturday','Sunday'] %}
          <option>{{ day }}</option>
          {% endfor %}
        </select>
      </div>
      
      <div class="col-md-2">
        <input type="date" name="start_date" class="form-control" required>
      </div>
      
      <div class="col-md-2">
        <input name="time_slot" class="form-control" placeholder="Time" required>
      </div>
      
      <div class="col-md-2">
        <input name="notes" class="form-control" placeholder="Notes">
      </div>

      <div class="col-12 text-end">
        <button type="submit" class="btn btn-primary">
          <i class="bi bi-plus-circle"></i> Add Batch
        </button>
      </div>
    </form>
  </div>
</div>
{% endif %}

<!-- Batches Table -->
<div class="table-responsive">
  <table class="table table-striped table-hover">
    <thead class="table-light">
      <tr>
        {% if all_batches_view %}<th>Class</th>{% endif %}
        <th>Batch Name</th>
        <th>Day</th>
        <th>Start Date</th>
        <th>Time</th>
        <th>Students</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for batch in batches %}
      <tr>
        {% if all_batches_view %}<td>{{ batch.class_name }}</td>{% endif %}
        <td>{{ batch.name }}</td>
        <td>{{ batch.day }}</td>
        <td>{{ batch.start_date.strftime('%Y-%m-%d') if batch.start_date else '' }}</td>
        <td>{{ batch.time_slot }}</td>
        <td><span class="badge bg-primary">{{ batch.student_count }}</span></td>
        <td>
          <div class="btn-group">
            <a href="{{ url_for('main.edit_batch', batch_id=batch.id) }}" 
               class="btn btn-sm btn-outline-primary">
              <i class="bi bi-pencil"></i>
            </a>
            <form method="POST" action="{{ url_for('main.delete_batch', batch_id=batch.id) }}">
              <button type="submit" class="btn btn-sm btn-outline-danger"
                      onclick="return confirm('Delete this batch?')">
                <i class="bi bi-trash"></i>
              </button>
            </form>
          </div>
        </td>
      </tr>
      {% else %}
      <tr>
        <td colspan="{% if all_batches_view %}7{% else %}6{% endif %}" class="text-center py-4">
          <div class="alert alert-warning mb-0">
            No batches found
          </div>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}